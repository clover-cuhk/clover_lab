<?xml version="1.0"?>
<robot name="base_cabinet" xmlns:xacro="http://wiki.ros.org/xacro">
  <material name="White">
    <color rgba="0.9 0.9 0.9 1.0"/>
  </material>
  <material name="Black">
    <color rgba="0.3 0.3 0.3 1.0"/>
  </material>
  <material name="Oak">
    <color rgba="0.89 0.81 0.69 1.0"/>
  </material>

  <xacro:property name="M_PI" value="3.1415926535897931"/>

  <!-- Using meter, kg -->

  <xacro:property name="base_xdim" value="0.6"/>
  <xacro:property name="base_ydim" value="1.8"/>
  <xacro:property name="base_zdim" value="0.08"/>
  <xacro:property name="base_mass" value="20"/>

  <!-- Frame refers to the main part of the cabinet -->
  <xacro:property name="frame_xdim" value="0.6"/>
  <xacro:property name="frame_ydim" value="1.8"/>
  <xacro:property name="frame_zdim" value="0.8"/>

  <xacro:property name="column_ydim" value="0.4"/>
  <xacro:property name="row_zdim" value="${frame_zdim/4}"/>

  <xacro:property name="thickness" value="0.016"/>
  <xacro:property name="tolerance" value="0.004"/>

  <xacro:property name="frame_back_panel_xdim" value="${thickness}"/>
  <xacro:property name="frame_back_panel_ydim" value="${frame_ydim}"/>
  <xacro:property name="frame_back_panel_zdim" value="${frame_zdim}"/>
  <xacro:property name="frame_back_panel_mass" value="20"/>

  <xacro:property name="frame_side_panel_xdim" value="${frame_xdim}"/>
  <xacro:property name="frame_side_panel_ydim" value="${thickness}"/>
  <xacro:property name="frame_side_panel_zdim" value="${frame_zdim}"/>
  <xacro:property name="frame_side_panel_mass" value="5"/>

  <!-- https://www.ikea.com.hk/zh/products/kitchen-worktops/kitchen-worktops/lilltrask-art-40280659-->
  <xacro:property name="worktop_xdim" value="0.635"/>
  <xacro:property name="worktop_ydim" value="1.86"/>
  <xacro:property name="worktop_zdim" value="0.028"/>
  <xacro:property name="worktop_mass" value="20.65"/>

  <!-- https://www.ikea.com.hk/en/products/knobs-and-handles/knobs-and-handles/bagganas-art-70338423 -->
  <xacro:property name="handle_mass" value="0.09"/>

  <!-- https://www.ikea.com.hk/en/products/kitchen-fronts/kitchen-fronts-cover-panels-and-plinth/enhet-art-90481556 -->
  <xacro:property name="door_xdim" value="${thickness}"/>
  <xacro:property name="door_ydim" value="${column_ydim-tolerance}"/>
  <xacro:property name="door_zdim" value="${frame_zdim-tolerance}"/>
  <xacro:property name="door_mass" value="3.31"/>

  <!-- https://www.ikea.com.hk/en/products/kitchen-fronts/kitchen-fronts-cover-panels-and-plinth/enhet-art-30481559 -->
  <xacro:property name="drawer_xdim" value="${frame_xdim-0.021}"/>
  <xacro:property name="drawer_zdim" value="${row_zdim-tolerance}"/>

  <xacro:property name="drawer_front_panel_xdim" value="${thickness}"/>
  <xacro:property name="drawer_front_panel_ydim" value="${column_ydim-tolerance}"/>
  <xacro:property name="drawer_front_panel_zdim" value="${drawer_zdim}"/>
  <xacro:property name="drawer_front_panel_mass" value="0.75"/>

  <!-- https://www.ikea.com.hk/en/products/kitchen-fronts/kitchen-fronts-cover-panels-and-plinth/metod-spr-39216457 -->
  <xacro:property name="drawer_side_panel_xdim" value="${drawer_xdim}"/>
  <xacro:property name="drawer_side_panel_ydim" value="${thickness}"/>
  <xacro:property name="drawer_side_panel_zdim" value="${drawer_zdim}"/>
  <xacro:property name="drawer_side_panel_mass" value="0.8"/>

  <xacro:property name="drawer_bottom_panel_xdim" value="${drawer_xdim}"/>
  <xacro:property name="drawer_bottom_panel_ydim" value="0.396"/>
  <xacro:property name="drawer_bottom_panel_zdim" value="${thickness}"/>
  <xacro:property name="drawer_bottom_panel_mass" value="0.8"/>

  <!--https://www.ikea.com.hk/en/products/kitchen-fronts/kitchen-fronts-cover-panels-and-plinth/askersund-art-50331776-->
  <xacro:property name="pull_out_front_panel_xdim" value="${thickness}"/>
  <xacro:property name="pull_out_front_panel_ydim" value="0.197"/>
  <xacro:property name="pull_out_front_panel_zdim" value="0.797"/>
  <xacro:property name="pull_out_front_panel_mass" value="1.66"/>

  <!--  https://www.ikea.com.hk/en/products/kitchen-fixed-interiors/kitchen-fixed-interiors/maximera-art-80297276-->

  <xacro:macro name="box_inertia" params="mass xdim ydim zdim">
    <inertia ixx="${mass * (ydim * ydim + zdim * zdim) / 12}" ixy="0" ixz="0"
             iyy="${mass * (xdim * xdim + zdim * zdim) / 12}" iyz="0"
             izz="${mass * (ydim * ydim + xdim * xdim) / 12}"/>
  </xacro:macro>

  <xacro:macro name="box_link" params="prefix link_name mass xdim ydim zdim material hinge='none'">
    <link name="${prefix}_${link_name}">
      <visual>
        <xacro:if value="${hinge == 'right'}">
          <origin xyz="${xdim/2} ${ydim/2} 0"/>
        </xacro:if>
        <xacro:if value="${hinge == 'left'}">
          <origin xyz="${xdim/2} -${ydim/2} 0"/>
        </xacro:if>
        <xacro:if value="${hinge == 'none'}">
          <origin xyz="0 0 0"/>
        </xacro:if>
        <geometry>
          <box size="${xdim} ${ydim} ${zdim}"/>
        </geometry>
        <material name="${material}"/>
      </visual>

      <collision>
        <xacro:if value="${hinge == 'right'}">
          <origin xyz="${xdim/2} ${ydim/2} 0"/>
        </xacro:if>
        <xacro:if value="${hinge == 'left'}">
          <origin xyz="${xdim/2} -${ydim/2} 0"/>
        </xacro:if>
        <xacro:if value="${hinge == 'none'}">
          <origin xyz="0 0 0"/>
        </xacro:if>
        <geometry>
          <box size="${xdim} ${ydim} ${zdim}"/>
        </geometry>
      </collision>

      <inertial>
        <xacro:if value="${hinge == 'right'}">
          <origin xyz="${xdim/2} ${ydim/2} 0"/>
        </xacro:if>
        <xacro:if value="${hinge == 'left'}">
          <origin xyz="${xdim/2} -${ydim/2} 0"/>
        </xacro:if>
        <xacro:if value="${hinge == 'none'}">
          <origin xyz="0 0 0"/>
        </xacro:if>
        <mass value="${mass}"/>
        <xacro:box_inertia mass="${mass}" xdim="${xdim}" ydim="${ydim}" zdim="${zdim}"/>
      </inertial>
    </link>
  </xacro:macro>

  <!-- Components -->

  <!--  <xacro:macro name="handle" params="prefix parent *origin">-->
  <!--    <link name="${prefix}_handle">-->
  <!--      <visual>-->
  <!--        <origin xyz="0 0 0" rpy="0 0 0"/>-->
  <!--        &lt;!&ndash;        <geometry>&ndash;&gt;-->
  <!--        &lt;!&ndash;          <box size="${worktop_ydim worktop_xdim worktop_zdim}"/>&ndash;&gt;-->
  <!--        &lt;!&ndash;        </geometry>&ndash;&gt;-->
  <!--        <material name="Black"/>-->
  <!--      </visual>-->

  <!--      <collision>-->
  <!--        <origin xyz="0 0 0" rpy="0 0 0"/>-->
  <!--        &lt;!&ndash;        <geometry>&ndash;&gt;-->
  <!--        &lt;!&ndash;          <box size="${worktop_ydim worktop_xdim worktop_zdim}"/>&ndash;&gt;-->
  <!--        &lt;!&ndash;        </geometry>&ndash;&gt;-->
  <!--      </collision>-->

  <!--      <inertial>-->
  <!--        <mass value="${handle_mass}"/>-->
  <!--        &lt;!&ndash;        <origin xyz="0 0 0"/>&ndash;&gt;-->
  <!--        &lt;!&ndash;        <xacro:box_inertia mass="${worktop_mass}" ydim="${worktop_ydim}" xdim="${worktop_xdim}"&ndash;&gt;-->
  <!--        &lt;!&ndash;                           zdim="${worktop_zdim}"/>&ndash;&gt;-->
  <!--      </inertial>-->
  <!--    </link>-->

  <!--    <joint name="{prefix}_handle_joint" type="fixed">-->
  <!--      <parent link="${parent}"/>-->
  <!--      <child link="{prefix}_handle_link"/>-->
  <!--      <xacro:insert_block name="origin"/>-->
  <!--    </joint>-->

  <!--  </xacro:macro>-->

  <xacro:macro name="door" params="prefix name parent xyz hinge">
    <xacro:box_link prefix="${prefix}" link_name="${name}" mass="${door_mass}"
                    xdim="${door_xdim}" ydim="${door_ydim}" zdim="${door_zdim}"
                    material="Oak" hinge="${hinge}"/>

    <joint name="${prefix}_${name}_joint" type="revolute">
      <parent link="${parent}"/>
      <child link="${prefix}_${name}"/>
      <limit effort="10" lower="0" upper="${M_PI / 2}" velocity="1"/>
      <dynamics damping="100" friction="0.1"/>
      <origin xyz="${xyz}"/>
      <xacro:if value="${hinge == 'right'}">
        <axis xyz="0 0 -1"/>
      </xacro:if>
      <xacro:unless value="${hinge == 'right'}">
        <axis xyz="0 0 1"/>
      </xacro:unless>
    </joint>
  </xacro:macro>

  <xacro:macro name="drawer" params="prefix name parent xyz">
    <xacro:box_link prefix="${prefix}" link_name="${name}_front_panel" mass="${drawer_front_panel_mass}"
                    xdim="${drawer_front_panel_xdim}" ydim="${drawer_front_panel_ydim}"
                    zdim="${drawer_front_panel_zdim}"
                    material="Oak"/>

    <joint name="${prefix}_${name}_front_panel_joint" type="prismatic">
      <parent link="${parent}"/>
      <child link="${prefix}_${name}_front_panel"/>
      <limit effort="10" lower="0" upper="${drawer_bottom_panel_xdim}" velocity="1"/>
      <dynamics damping="100" friction="0.1"/>
      <origin xyz="${xyz}"/>
      <axis xyz="1 0 0"/>
    </joint>

    <xacro:box_link prefix="${prefix}" link_name="${name}_bottom_panel" mass="${drawer_bottom_panel_mass}"
                    xdim="${drawer_bottom_panel_xdim}" ydim="${drawer_bottom_panel_ydim}"
                    zdim="${drawer_bottom_panel_zdim}"
                    material="White"/>

    <joint name="${prefix}_${name}_bottom_panel_joint" type="fixed">
      <parent link="${prefix}_${name}_front_panel"/>
      <child link="${prefix}_${name}_bottom_panel"/>
      <origin xyz="${(-drawer_front_panel_xdim-drawer_bottom_panel_xdim)/2}
                    0 ${(-drawer_front_panel_zdim+drawer_bottom_panel_zdim)/2}"
      />
    </joint>

    <xacro:box_link prefix="${prefix}" link_name="${name}_left_side_panel" mass="${drawer_side_panel_mass}"
                    xdim="${drawer_side_panel_xdim}" ydim="${drawer_side_panel_ydim}" zdim="${drawer_side_panel_zdim}"
                    material="White"/>

    <joint name="${prefix}_${name}_left_side_panel_joint" type="fixed">
      <parent link="${prefix}_${name}_front_panel"/>
      <child link="${prefix}_${name}_left_side_panel"/>
      <origin xyz="${(-drawer_front_panel_xdim-drawer_side_panel_xdim)/2}
                    ${(drawer_front_panel_ydim-drawer_side_panel_ydim)/2} 0"
      />
    </joint>

    <xacro:box_link prefix="${prefix}" link_name="${name}_right_side_panel" mass="${drawer_side_panel_mass}"
                    xdim="${drawer_side_panel_xdim}" ydim="${drawer_side_panel_ydim}" zdim="${drawer_side_panel_zdim}"
                    material="White"/>

    <joint name="${prefix}_${name}_right_side_panel_joint" type="fixed">
      <parent link="${prefix}_${name}_front_panel"/>
      <child link="${prefix}_${name}_right_side_panel"/>
      <origin xyz="${(-drawer_front_panel_xdim-drawer_side_panel_xdim)/2}
                    ${(-drawer_front_panel_ydim+drawer_side_panel_ydim)/2} 0"
      />
    </joint>
  </xacro:macro>

  <xacro:macro name="pull_out" params="prefix name parent xyz">
    <xacro:box_link prefix="${prefix}" link_name="${name}_front_panel" mass="${pull_out_front_panel_mass}"
                    xdim="${pull_out_front_panel_xdim}" ydim="${pull_out_front_panel_ydim}"
                    zdim="${pull_out_front_panel_zdim}"
                    material="Oak"/>

    <joint name="${prefix}_${name}_front_panel_joint" type="prismatic">
      <parent link="${parent}"/>
      <child link="${prefix}_${name}_front_panel"/>
      <limit effort="10" lower="0" upper="${drawer_bottom_panel_xdim}" velocity="1"/>
      <dynamics damping="100" friction="0.1"/>
      <origin xyz="${xyz}"/>
      <axis xyz="1 0 0"/>
    </joint>

<!--    <xacro:box_link prefix="${prefix}" link_name="${name}_bottom_panel" mass="${drawer_bottom_panel_mass}"-->
<!--                    xdim="${drawer_bottom_panel_xdim}" ydim="${drawer_bottom_panel_ydim}"-->
<!--                    zdim="${drawer_bottom_panel_zdim}"-->
<!--                    material="White"/>-->

<!--    <joint name="${prefix}_${name}_bottom_panel_joint" type="fixed">-->
<!--      <parent link="${prefix}_${name}_front_panel"/>-->
<!--      <child link="${prefix}_${name}_bottom_panel"/>-->
<!--      <origin xyz="${(-drawer_front_panel_xdim-drawer_bottom_panel_xdim)/2}-->
<!--                    0 ${(-drawer_front_panel_zdim+drawer_bottom_panel_zdim)/2}"-->
<!--      />-->
<!--    </joint>-->

<!--    <xacro:box_link prefix="${prefix}" link_name="${name}_left_side_panel" mass="${drawer_side_panel_mass}"-->
<!--                    xdim="${drawer_side_panel_xdim}" ydim="${drawer_side_panel_ydim}" zdim="${drawer_side_panel_zdim}"-->
<!--                    material="White"/>-->

<!--    <joint name="${prefix}_${name}_left_side_panel_joint" type="fixed">-->
<!--      <parent link="${prefix}_${name}_front_panel"/>-->
<!--      <child link="${prefix}_${name}_left_side_panel"/>-->
<!--      <origin xyz="${(-drawer_front_panel_xdim-drawer_side_panel_xdim)/2}-->
<!--                    ${(drawer_front_panel_ydim-drawer_side_panel_ydim)/2} 0"-->
<!--      />-->
<!--    </joint>-->

<!--    <xacro:box_link prefix="${prefix}" link_name="${name}_right_side_panel" mass="${drawer_side_panel_mass}"-->
<!--                    xdim="${drawer_side_panel_xdim}" ydim="${drawer_side_panel_ydim}" zdim="${drawer_side_panel_zdim}"-->
<!--                    material="White"/>-->

<!--    <joint name="${prefix}_${name}_right_side_panel_joint" type="fixed">-->
<!--      <parent link="${prefix}_${name}_front_panel"/>-->
<!--      <child link="${prefix}_${name}_right_side_panel"/>-->
<!--      <origin xyz="${(-drawer_front_panel_xdim-drawer_side_panel_xdim)/2}-->
<!--                    ${(-drawer_front_panel_ydim+drawer_side_panel_ydim)/2} 0"-->
<!--      />-->
<!--    </joint>-->
  </xacro:macro>

  <!-- Assembles -->
  <xacro:macro name="frame" params="prefix">
    <xacro:box_link prefix="${prefix}" link_name="base_link" mass="${base_mass}" xdim="${base_xdim}" ydim="${base_ydim}"
                    zdim="${base_zdim}" material="White"/>

    <xacro:box_link prefix="${prefix}" link_name="frame_left_side_panel" mass="${frame_side_panel_mass}"
                    xdim="${frame_side_panel_xdim}" ydim="${frame_side_panel_ydim}" zdim="${frame_side_panel_zdim}"
                    material="White"/>

    <joint name="${prefix}_frame_left_side_panel_joint" type="fixed">
      <origin xyz="0 ${(base_ydim-frame_side_panel_ydim)/2} ${(base_zdim+frame_side_panel_zdim)/2}" rpy="0 0 0"/>
      <parent link="${prefix}_base_link"/>
      <child link="${prefix}_frame_left_side_panel"/>
    </joint>

    <xacro:box_link prefix="${prefix}" link_name="frame_right_side_panel" mass="${frame_side_panel_mass}"
                    xdim="${frame_side_panel_xdim}" ydim="${frame_side_panel_ydim}" zdim="${frame_side_panel_zdim}"
                    material="White"/>

    <joint name="${prefix}_frame_right_side_panel_joint" type="fixed">
      <origin xyz="0 ${(-base_ydim+frame_side_panel_ydim)/2} ${(base_zdim+frame_side_panel_zdim)/2}" rpy="0 0 0"/>
      <parent link="${prefix}_base_link"/>
      <child link="${prefix}_frame_right_side_panel"/>
    </joint>

    <xacro:box_link prefix="${prefix}" link_name="frame_back_panel" mass="${frame_back_panel_mass}"
                    xdim="${frame_back_panel_xdim}" ydim="${frame_back_panel_ydim}" zdim="${frame_back_panel_zdim}"
                    material="White"/>

    <joint name="${prefix}_back_panel_joint" type="fixed">
      <origin xyz="${(-base_xdim+frame_back_panel_xdim)/2} 0 ${(base_zdim+frame_back_panel_zdim)/2}" rpy="0 0 0"/>
      <parent link="${prefix}_base_link"/>
      <child link="${prefix}_frame_back_panel"/>
    </joint>

    <xacro:box_link prefix="${prefix}" link_name="worktop" mass="${worktop_mass}"
                    xdim="${worktop_xdim}" ydim="${worktop_ydim}" zdim="${worktop_zdim}"
                    material="White"/>

    <joint name="${prefix}_worktop_joint" type="fixed">
      <origin xyz="0 0 ${(base_zdim+worktop_zdim)/2+frame_back_panel_zdim}" rpy="0 0 0"/>
      <parent link="${prefix}_base_link"/>
      <child link="${prefix}_worktop"/>
    </joint>

  </xacro:macro>

</robot>
